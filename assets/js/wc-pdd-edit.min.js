var WC_PDD={init:function(){var e="#general_product_data .options_group.show_if_downloadable",a='<input type="text" class="file_date input_text" placeholder="'+wc_pdd_edit_params.placeholder+'" name="_wc_file_dates[]" value="">';0!==jQuery(e).length&&(this.addDateField(e,a),this.replaceNewDateField(e,a),this.runDatepicker()),this.loadDatesForVariations()},addDateField:function(e,a){var t=0,i=wc_pdd_edit_params.file_dates.split(",");jQuery(e).find(".file_name").each(function(){jQuery(this).append(a),void 0!==i[t]&&jQuery(this).find(".file_date").val(i[t]),t++})},replaceNewDateField:function(e,a){var t=jQuery(e).find(".button.insert").attr("data-row");t=jQuery(t),t.find(".file_name").append(a),jQuery(e).find(".button.insert").attr("data-row","<tr>"+t.html()+"</tr>"),jQuery(e+" .button.insert").on("click",function(){setTimeout(function(){jQuery(document.body).trigger("wc-init-datepickers")},500)})},runDatepicker:function(){jQuery(document.body).on("wc-init-datepickers",function(){jQuery(".file_name .file_date").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0})}).trigger("wc-init-datepickers")},loadDatesForVariations:function(){var e=this;jQuery(document.body).on("woocommerce_variations_loaded",function(){var a="#variable_product_options .show_if_variation_downloadable";e.addDateFieldVariations(a),e.runDatepicker(),e.fillVariationDateValues(),e.replaceVariationsNewDateField(a),e.reloadVariationsInfoOnSave(a)})},addDateFieldVariations:function(e){var a=0;jQuery(e).find(".file_name").each(function(){var e=jQuery(this).find(".input_text").clone();e.addClass("file_date"),e.val(""),e.attr("placeholder","File Date"),e.attr("value","");var t=e.attr("name");t=t.replace("_wc_variation_file_names","_wc_variation_file_dates"),e.attr("name",t),jQuery(this).append(e),a++})},fillVariationDateValues:function(){if(wc_pdd_edit_params.variation_file_dates){var e=wc_pdd_edit_params.variation_file_dates;for(var a in e)if(e.hasOwnProperty(a)){var t=0,i=e[a].split(",");jQuery('input[name="_wc_variation_file_dates['+a+'][]"]').each(function(){void 0!==i[t]&&jQuery(this).val(i[t]),t++})}}},replaceVariationsNewDateField:function(e){jQuery(e).find(".button.insert").each(function(){var e=jQuery(this).attr("data-row");if(e=jQuery(e),!1===jQuery(this).hasClass("date-added")){var a=e.find(".file_name .input_text").clone(!0);a.addClass("file_date"),a.val(""),a.attr("placeholder","File Date"),a.attr("value","");var t=a.attr("name");t=t.replace("_wc_variation_file_names","_wc_variation_file_dates"),a.attr("name",t),e.find(".file_name").append(a),jQuery(this).attr("data-row","<tr>"+e.html()+"</tr>"),jQuery(this).addClass("date-added"),jQuery(this).on("click",function(){setTimeout(function(){jQuery(document.body).trigger("wc-init-datepickers")},500)})}})},reloadVariationsInfoOnSave:function(e){jQuery(document.body).on("woocommerce_variations_save_variations_button",function(){var a=[],t={};if(jQuery(e).find(".file_name .file_date").each(function(){var e=jQuery(this).val(),t=jQuery(this).attr("name");t=t.replace("_wc_variation_file_dates[",""),t=t.replace("][]",""),void 0===a[t]&&(a[t]=[]),a[t].push(e)}),0!==a.length){for(var i in a)a.hasOwnProperty(i)&&(t[i]=a[i].join(","));wc_pdd_edit_params.variation_file_dates=t}})}};jQuery(document).ready(function(){WC_PDD.init()});